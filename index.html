<!DOCTYPE html>
<html lang="zh-CN" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾®åšçƒ­æœèˆ†æƒ…ç›‘æµ‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Noto Sans SC', 'sans-serif'] },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'spin-slow': 'spin 20s linear infinite',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Noto Sans SC', sans-serif; }
        .gradient-text { background: linear-gradient(135deg, #f97316 0%, #dc2626 50%, #db2777 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .glass { background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-4px); }
        .tab-active { border-bottom: 2px solid #f97316; color: #f97316; }
        .sentiment-positive { color: #22c55e; }
        .sentiment-negative { color: #ef4444; }
        .live-pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .word-cloud span { transition: all 0.3s; }
        .word-cloud span:hover { transform: scale(1.2); }
        .export-btn { transition: all 0.2s; }
        .export-btn:hover { background: rgba(255,255,255,0.2); }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 min-h-screen text-slate-100">
    <!-- å¯¼èˆª -->
    <nav class="fixed top-0 left-0 right-0 z-50 glass">
        <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="relative">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-orange-500 to-pink-500 flex items-center justify-center">ğŸ”¥</div>
                    <span class="absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full live-pulse"></span>
                </div>
                <div>
                    <h1 class="font-bold">å¾®åšçƒ­æœèˆ†æƒ…</h1>
                    <p class="text-xs text-slate-400 flex items-center gap-1">
                        <span class="w-2 h-2 bg-green-500 rounded-full live-pulse"></span>
                        å®æ—¶æ›´æ–°
                    </p>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button onclick="switchTab('overview')" id="tab-overview" class="px-3 py-1 text-sm tab-active">æ¦‚è§ˆ</button>
                <button onclick="switchTab('sentiment')" id="tab-sentiment" class="px-3 py-1 text-sm text-slate-400 hover:text-white">æƒ…æ„Ÿ</button>
                <button onclick="switchTab('trends')" id="tab-trends" class="px-3 py-1 text-sm text-slate-400 hover:text-white">è¶‹åŠ¿</button>
                <button onclick="switchTab('topics')" id="tab-topics" class="px-3 py-1 text-sm text-slate-400 hover:text-white">ä¸»é¢˜</button>
                <button onclick="switchTab('export')" id="tab-export" class="px-3 py-1 text-sm text-slate-400 hover:text-white">å¯¼å‡º</button>
            </div>
        </div>
    </nav>

    <main class="pt-24 pb-12 px-4">
        <div class="max-w-7xl mx-auto">
            <!-- æ ‡é¢˜ -->
            <div class="text-center mb-6">
                <h1 class="text-3xl font-bold"><span class="gradient-text">å¾®åšçƒ­æœèˆ†æƒ…ç›‘æµ‹</span></h1>
                <p class="text-slate-400 text-sm mt-1">æ™ºèƒ½åˆ†æ Â· å®æ—¶è¿½è¸ª Â· å¤šç»´å¯è§†åŒ–</p>
            </div>

            <!-- æ¦‚è§ˆ -->
            <div id="panel-overview" class="tab-panel">
                <!-- ç»Ÿè®¡ -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
                    <div class="glass rounded-xl p-4 text-center"><div class="text-xs text-slate-400">çƒ­æœäº‹ä»¶</div><div class="text-2xl font-bold" id="totalEvents">--</div></div>
                    <div class="glass rounded-xl p-4 text-center"><div class="text-xs text-slate-400">æ€»çƒ­åº¦</div><div class="text-2xl font-bold gradient-text" id="totalHeat">--</div></div>
                    <div class="glass rounded-xl p-4 text-center"><div class="text-xs text-slate-400">æ­£é¢æƒ…æ„Ÿ</div><div class="text-2xl font-bold sentiment-positive" id="positiveRatio">--</div></div>
                    <div class="glass rounded-xl p-4 text-center"><div class="text-xs text-slate-400">æ›´æ–°æ—¶é—´</div><div class="text-sm font-bold" id="lastUpdate">--</div></div>
                </div>

                <!-- åˆ†ç±» -->
                <div class="grid md:grid-cols-3 gap-4 mb-6" id="categories"></div>

                <!-- TOP15 -->
                <div class="glass rounded-xl p-4">
                    <h3 class="font-bold mb-3">ğŸ”¥ çƒ­ç‚¹æ’è¡Œ</h3>
                    <div class="space-y-2" id="topEvents"></div>
                </div>
            </div>

            <!-- æƒ…æ„Ÿ -->
            <div id="panel-sentiment" class="tab-panel hidden">
                <div class="grid md:grid-cols-2 gap-4 mb-4">
                    <div class="glass rounded-xl p-4">
                        <h3 class="font-bold mb-3">æƒ…æ„Ÿåˆ†å¸ƒ</h3>
                        <div class="flex justify-center gap-6 py-4">
                            <div class="text-center"><div class="text-3xl font-bold sentiment-positive" id="posPct">0%</div><div class="text-xs text-slate-400">æ­£é¢</div></div>
                            <div class="text-center"><div class="text-3xl font-bold" id="neuPct">0%</div><div class="text-xs text-slate-400">ä¸­æ€§</div></div>
                            <div class="text-center"><div class="text-3xl font-bold sentiment-negative" id="negPct">0%</div><div class="text-xs text-slate-400">è´Ÿé¢</div></div>
                        </div>
                    </div>
                    <div class="glass rounded-xl p-4">
                        <h3 class="font-bold mb-3">ğŸ”¥ æƒ…æ„Ÿçƒ­è¯</h3>
                        <div class="word-cloud flex flex-wrap gap-2 justify-center" id="sentimentWords"></div>
                    </div>
                </div>
                <div class="glass rounded-xl p-4">
                    <h3 class="font-bold mb-3">é«˜çƒ­åº¦äº‹ä»¶æƒ…æ„Ÿ</h3>
                    <div class="space-y-2" id="sentimentEvents"></div>
                </div>
            </div>

            <!-- è¶‹åŠ¿ -->
            <div id="panel-trends" class="tab-panel hidden">
                <div class="glass rounded-xl p-4 mb-4">
                    <h3 class="font-bold mb-3">ğŸ“ˆ 24å°æ—¶çƒ­åº¦è¶‹åŠ¿</h3>
                    <div class="h-32 flex items-end gap-1" id="trendChart"></div>
                </div>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="glass rounded-xl p-4">
                        <h3 class="font-bold mb-3 text-green-400">â†‘ ä¸Šå‡æœ€å¿«</h3>
                        <div class="space-y-2" id="risingEvents"></div>
                    </div>
                    <div class="glass rounded-xl p-4">
                        <h3 class="font-bold mb-3 text-red-400">â†“ å¿«é€Ÿä¸‹é™</h3>
                        <div class="space-y-2" id="fallingEvents"></div>
                    </div>
                </div>
            </div>

            <!-- ä¸»é¢˜ -->
            <div id="panel-topics" class="tab-panel hidden">
                <div class="glass rounded-xl p-4 mb-4">
                    <h3 class="font-bold mb-3">ğŸ” ä¸»é¢˜åˆ†å¸ƒ</h3>
                    <div class="grid md:grid-cols-2 gap-3" id="topics"></div>
                </div>
                <div class="glass rounded-xl p-4">
                    <h3 class="font-bold mb-3">â˜ï¸ è¯äº‘</h3>
                    <div class="word-cloud min-h-[200px] flex flex-wrap gap-3 justify-center items-center py-8" id="wordCloud"></div>
                </div>
            </div>

            <!-- å¯¼å‡º -->
            <div id="panel-export" class="tab-panel hidden">
                <div class="glass rounded-xl p-6">
                    <h3 class="font-bold mb-4">ğŸ“¦ æ•°æ®å¯¼å‡º</h3>
                    <div class="grid md:grid-cols-3 gap-4">
                        <button onclick="exportData('json')" class="export-btn glass rounded-xl p-4 text-center hover:bg-white/10">
                            <div class="text-3xl mb-2">ğŸ“„</div>
                            <div class="font-medium">JSON</div>
                            <div class="text-xs text-slate-400">åŸå§‹æ•°æ®</div>
                        </button>
                        <button onclick="exportData('csv')" class="export-btn glass rounded-xl p-4 text-center hover:bg-white/10">
                            <div class="text-3xl mb-2">ğŸ“Š</div>
                            <div class="font-medium">CSV</div>
                            <div class="text-xs text-slate-400">è¡¨æ ¼æ–‡ä»¶</div>
                        </button>
                        <button onclick="exportData('md')" class="export-btn glass rounded-xl p-4 text-center hover:bg-white/10">
                            <div class="text-3xl mb-2">ğŸ“</div>
                            <div class="font-medium">Markdown</div>
                            <div class="text-xs text-slate-400">æŠ¥å‘Šæ–‡æ¡£</div>
                        </button>
                    </div>
                    <div class="mt-6">
                        <h4 class="font-medium mb-2">API æ¥å£</h4>
                        <div class="bg-slate-800 rounded-lg p-3 text-sm font-mono text-slate-300">
                            <div>GET /data/today.json - ä»Šæ—¥æ•°æ®</div>
                            <div>GET /data/2026-02-27.json - æŒ‡å®šæ—¥æœŸ</div>
                            <div>GET /api/sentiment - æƒ…æ„Ÿåˆ†æ</div>
                            <div>GET /api/trends - è¶‹åŠ¿æ•°æ®</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="border-t border-slate-800 py-4 text-center text-slate-500 text-xs">
        <p>Â© 2026 å¾®åšçƒ­æœèˆ†æƒ…ç›‘æµ‹ Â· <span id="updateTime">--:--</span> æ›´æ–°</p>
    </footer>

    <script>
        let currentData = null;
        
        function switchTab(tab) {
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.add('hidden'));
            document.getElementById('panel-' + tab).classList.remove('hidden');
            document.querySelectorAll('[id^="tab-"]').forEach(b => {
                b.classList.remove('tab-active');
                b.classList.add('text-slate-400');
            });
            document.getElementById('tab-' + tab).classList.add('tab-active');
            document.getElementById('tab-' + tab).classList.remove('text-slate-400');
        }

        async function loadData() {
            try {
                const response = await fetch('/data/2026-02-27.json');
                currentData = await response.json();
            } catch (e) {
                currentData = getDemoData();
            }
            renderAll();
            // è‡ªåŠ¨åˆ·æ–°
            setTimeout(loadData, 60000);
        }

        function renderAll() {
            if (!currentData) return;
            const d = currentData;
            
            document.getElementById('totalEvents').textContent = d.summary?.totalEvents || 0;
            document.getElementById('totalHeat').textContent = formatHeat(d.summary?.totalHeat || 0);
            document.getElementById('lastUpdate').textContent = new Date(d.generatedAt).toLocaleTimeString('zh-CN', {hour:'2-digit', minute:'2-digit'});
            document.getElementById('updateTime').textContent = new Date(d.generatedAt).toLocaleTimeString();
            
            const s = d.sentiment || {positive:30, negative:20, neutral:50};
            document.getElementById('positiveRatio').textContent = s.positive + '%';
            document.getElementById('posPct').textContent = s.positive + '%';
            document.getElementById('negPct').textContent = s.negative + '%';
            document.getElementById('neuPct').textContent = s.neutral + '%';

            // åˆ†ç±»
            const cfg = {social:{e:'ğŸ”¥',c:'#ef4444'},tech:{e:'ğŸ¤–',c:'#8b5cf6'},entertainment:{e:'ğŸ¬',c:'#a855f7'},business:{e:'ğŸ“ˆ',c:'#22c55e'},sports:{e:'ğŸ†',c:'#eab308'}};
            document.getElementById('categories').innerHTML = Object.entries(d.categories||{}).filter(([_,x])=>x.events?.length).sort((a,b)=>(b[1].totalHeat||0)-(a[1].totalHeat||0)).slice(0,6).map(([id,x])=>`<div class="glass rounded-xl overflow-hidden"><div class="px-3 py-2" style="background:${(cfg[id]||{c:'#666'}).c}30"><div class="flex justify-between"><span>${(cfg[id]||{e:'ğŸ“Œ'}).e} ${(cfg[id]||{n:id}).n||id}</span><span class="font-bold" style="color:${(cfg[id]||{c:'#666'}).c}">${formatHeat(x.totalHeat||0)}</span></div></div><div class="p-2 text-xs text-slate-400 truncate">${(x.events||[])[0]?.title||''}</div></div>`).join('');

            // TOP
            document.getElementById('topEvents').innerHTML = (d.topEvents||[]).slice(0,15).map((e,i)=>`<div class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-800"><span class="w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${i<3?'bg-gradient-to-br from-yellow-400 to-orange-500':'bg-slate-700'}">${i+1}</span><div class="flex-1 truncate text-sm">${e.title}</div><span class="text-xs ${e.trend==='rising'?'text-green-400':e.trend==='falling'?'text-red-400':'text-slate-500'}">${e.trend==='rising'?'â†‘':e.trend==='falling'?'â†“':'â†’'}</span></div>`).join('');

            // æƒ…æ„Ÿè¯
            const posWords = ['å¸Œæœ›','å¼€å¿ƒ','æ„ŸåŠ¨','æ”¯æŒ','åŠ æ²¹','èµ','å‰å®³','ç‰›','æ£’','çˆ±äº†'];
            const negWords = ['å¤±æœ›','æ„¤æ€’','æ— è¯­','æ¶å¿ƒ','åƒåœ¾','éª—','è¿‡åˆ†','è½¦ç¥¸','æ­»äº¡','çŠ¯ç½ª'];
            document.getElementById('sentimentWords').innerHTML = posWords.slice(0,5).map(w=>`<span class="px-2 py-1 bg-green-900/50 rounded text-green-400 text-sm cursor-pointer">${w}</span>`).join('') + '<br/>' + negWords.slice(0,5).map(w=>`<span class="px-2 py-1 bg-red-900/50 rounded text-red-400 text-sm cursor-pointer">${w}</span>`).join('');

            // è¶‹åŠ¿å›¾
            document.getElementById('trendChart').innerHTML = Array(24).fill(0).map((_,i)=>`<div class="flex-1 bg-gradient-to-t from-orange-500 to-pink-500 rounded-t" style="height:${20+Math.random()*80}%"></div>`).join('');

            // ä¸Šå‡ä¸‹é™
            const rising = (d.topEvents||[]).filter(e=>e.trend==='rising').slice(0,5);
            const falling = (d.topEvents||[]).filter(e=>e.trend==='falling').slice(0,5);
            document.getElementById('risingEvents').innerHTML = rising.length ? rising.map(e=>`<div class="flex items-center gap-2 text-sm"><span class="text-green-400">â†‘</span><div class="flex-1 truncate">${e.title}</div></div>`).join('') : '<div class="text-slate-500 text-sm">æš‚æ— </div>';
            document.getElementById('fallingEvents').innerHTML = falling.length ? falling.map(e=>`<div class="flex items-center gap-2 text-sm"><span class="text-red-400">â†“</span><div class="flex-1 truncate">${e.title}</div></div>`).join('') : '<div class="text-slate-500 text-sm">æš‚æ— </div>';

            // ä¸»é¢˜
            const topics = [{n:'ç¤¾ä¼šçƒ­ç‚¹',w:['ç–«æƒ…','äº‹æ•…','ç¾å®³','å®‰å…¨','çŠ¯ç½ª']},{n:'ç§‘æŠ€å‰æ²¿',w:['AI','æ‰‹æœº','èŠ¯ç‰‡','æ™ºèƒ½','äº’è”ç½‘']},{n:'å¨±ä¹å…«å¦',w:['æ˜æ˜Ÿ','æ‹æƒ…','å®˜å®£','æ–°å‰§','ç»¼è‰º']},{n:'ä½“è‚²ç«æŠ€',w:['æ¯”èµ›','å† å†›','çƒå‘˜','è¿›çƒ','ä¸–ç•Œæ¯']}];
            document.getElementById('topics').innerHTML = topics.map(t=>`<div class="glass rounded-lg p-3"><div class="font-medium mb-2">${t.n}</div><div class="flex flex-wrap gap-1">${t.w.map((w,i)=>`<span class="px-2 py-0.5 bg-slate-700 rounded text-xs" style="font-size:${14-i}px">${w}</span>`).join('')}</div></div>`).join('');

            // è¯äº‘
            const cloudWords = ['ä¸­å›½ç”·è¶³','æ‰‹æœºæ¶¨ä»·','æ¨å¹‚','é“¶å‘ç»æµ','æ±Ÿè¥¿è½¦ç¥¸','AI','ä¸–ç•Œæ¯','æ˜æ˜Ÿ','è‚¡ç¥¨','é«˜è€ƒ','æ—…æ¸¸','ç¾é£Ÿ','è¶³çƒ','ç¯®çƒ','ç”µå½±','ç”µè§†å‰§'];
            document.getElementById('wordCloud').innerHTML = cloudWords.map((w,i)=>`<span class="cursor-pointer hover:text-orange-400" style="font-size:${12+Math.random()*16}px;color:hsl(${Math.random()*60+10},70%,60%)">${w}</span>`).join('');
        }

        function formatHeat(v) {
            if(v>=1e8) return (v/1e8).toFixed(1)+'äº¿';
            if(v>=1e4) return (v/1e4).toFixed(1)+'ä¸‡';
            return v.toString();
        }

        function exportData(format) {
            if(!currentData) return alert('æš‚æ— æ•°æ®');
            let content, filename, type;
            if(format==='json') {
                content = JSON.stringify(currentData, null, 2);
                filename = 'weibo-data.json';
                type = 'application/json';
            } else if(format==='csv') {
                const rows = [['æ’å','æ ‡é¢˜','çƒ­åº¦','åˆ†ç±»','è¶‹åŠ¿']];
                (currentData.topEvents||[]).forEach(e=>rows.push([e.rank,e.title,e.hotValue,e.category,e.trend]));
                content = rows.map(r=>r.join(',')).join('\n');
                filename = 'weibo-data.csv';
                type = 'text/csv';
            } else {
                content = `# å¾®åšçƒ­æœèˆ†æƒ…æŠ¥å‘Š\n\nç”Ÿæˆæ—¶é—´: ${currentData.generatedAt}\n\n## TOP10\n\n` + (currentData.topEvents||[]).slice(0,10).map((e,i)=>`${i+1}. ${e.title} (çƒ­åº¦: ${formatHeat(e.hotValue)})`).join('\n');
                filename = 'weibo-report.md';
                type = 'text/markdown';
            }
            const blob = new Blob([content], {type});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = filename;
            a.click();
        }

        function getDemoData() {
            return {
                summary: {totalEvents: 50, totalHeat: 2500000},
                sentiment: {positive: 32, negative: 18, neutral: 50},
                generatedAt: new Date().toISOString(),
                categories: {
                    social: {events:[{title:'ä¸­å›½ç”·è¶³æˆ˜èƒœæ—¥æœ¬',rank:1,hotValue:1230000}],totalHeat:1800000},
                    tech: {events:[{title:'æ‰‹æœºæ¶¨ä»·',rank:2,hotValue:1060000}],totalHeat:850000}
                },
                topEvents: [
                    {title:'ä¸­å›½ç”·è¶³æˆ˜èƒœæ—¥æœ¬',rank:1,hotValue:1230000,trend:'rising'},
                    {title:'æ‰‹æœºæ¶¨ä»·',rank:2,hotValue:1060000,trend:'stable'},
                    {title:'æ¨å¹‚æ–°å‰§',rank:3,hotValue:980000,trend:'rising'},
                    {title:'é“¶å‘ç»æµ',rank:4,hotValue:850000,trend:'falling'},
                    {title:'æ±Ÿè¥¿è½¦ç¥¸',rank:5,hotValue:450000,trend:'stable'}
                ]
            };
        }

        loadData();
    </script>
</body>
</html>
